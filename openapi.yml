openapi: 3.0.0
info:
  title: Pet Store API
  version: 1.0.0
  description: Пример API для магазина животных

servers:
  - url: https://api.petstore.com/v1
    description: Production
  - url: http://localhost:8000/api
    description: Local development

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    Pet:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Барсик
        category:
          type: object
          properties:
            id:
              type: integer
              example: 1
            name:
              type: string
              example: Кошки
        tags:
          type: array
          items:
            type: object
            properties:
              id:
                type: integer
                example: 1
              name:
                type: string
                example: милый
        status:
          type: string
          enum: [available, pending, sold]
          example: available
        age:
          type: integer
          minimum: 0
          maximum: 30
          example: 3
      required: [name, status]

    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: Иван Петров
        email:
          type: string
          example: ivan@mail.com
        role:
          type: string
          example: user

    LoginRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: admin@petstore.com
        password:
          type: string
          format: password
          example: secret123
      required: [email, password]

    LoginResponse:
      type: object
      properties:
        token:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        user:
          $ref: '#/components/schemas/User'

    Error:
      type: object
      properties:
        code:
          type: integer
          example: 400
        message:
          type: string
          example: Validation failed
        errors:
          type: object
          example:
            email: ["The email field is required"]

    UploadResponse:
      type: object
      properties:
        id:
          type: integer
          example: 1
        url:
          type: string
          example: /storage/pets/photo.jpg

  parameters:
    petIdParam:
      name: petId
      in: path
      required: true
      schema:
        type: integer
      example: 42
    limitParam:
      name: limit
      in: query
      description: Количество записей
      schema:
        type: integer
        default: 15
        maximum: 100
      example: 20
    pageParam:
      name: page
      in: query
      description: Номер страницы
      schema:
        type: integer
        default: 1
      example: 2
    statusParam:
      name: status
      in: query
      schema:
        type: string
        enum: [available, pending, sold]
      example: available

security:
  - bearerAuth: []

paths:
  /auth/login:
    post:
      tags: [auth]
      summary: Вход в систему
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Успешный вход
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          description: Неверные учетные данные
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/me:
    get:
      tags: [auth]
      summary: Информация о текущем пользователе
      operationId: me
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /pets:
    get:
      tags: [pets]
      summary: Список питомцев
      operationId: listPets
      parameters:
        - $ref: '#/components/parameters/limitParam'
        - $ref: '#/components/parameters/pageParam'
        - $ref: '#/components/parameters/statusParam'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Pet'
                  meta:
                    type: object
                    properties:
                      total:
                        type: integer
                        example: 100
                      page:
                        type: integer
                        example: 1
                  last_page:
                    type: integer
                    example: 10

    post:
      tags: [pets]
      summary: Создать питомца
      operationId: createPet
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Pet'
      responses:
        '201':
          description: Создано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Pet'
        '422':
          description: Ошибка валидации
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /pets/{petId}:
    get:
      tags: [pets]
      summary: Получить питомца
      operationId: getPet
      parameters:
        - $ref: '#/components/parameters/petIdParam'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Pet'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [pets]
      summary: Обновить питомца
      operationId: updatePet
      parameters:
        - $ref: '#/components/parameters/petIdParam'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Pet'
      responses:
        '200':
          $ref: '#/components/responses/PetResponse'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags: [pets]
      summary: Удалить питомца
      operationId: deletePet
      parameters:
        - $ref: '#/components/parameters/petIdParam'
      responses:
        '204':
          description: Удалено без контента
        '404':
          $ref: '#/components/responses/NotFound'

  /pets/{petId}/upload:
    post:
      tags: [pets]
      summary: Загрузить фото
      operationId: uploadPetPhoto
      parameters:
        - $ref: '#/components/parameters/petIdParam'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                photo:
                  type: string
                  format: binary
                  description: Файл изображения
                caption:
                  type: string
                  example: Мой любимый котик
              required: [photo]
      responses:
        '201':
          description: Фото загружено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'

  /pets/filter:
    get:
      tags: [pets]
      summary: Сложный поиск с фильтрами
      operationId: filterPets
      parameters:
        - name: filters
          in: query
          style: deepObject
          schema:
            type: object
            properties:
              category:
                type: string
                example: cats
              age_from:
                type: integer
                example: 1
              age_to:
                type: integer
                example: 5
              tags:
                type: array
                items:
                  type: string
                example: [милый, пушистый]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Pet'
